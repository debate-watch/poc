<html>
<head>
  <title>Debate Watch</title>
  <link rel="stylesheet" href="bower_components/octicons/octicons/octicons.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/core.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/slider.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/theme.css">
  <link rel="stylesheet" href="bower_components/jquery-ui-slider-pips/dist/jquery-ui-slider-pips.css">
  <link rel="stylesheet" href="bower_components/circular-slider/dist/circular-slider.min.css">
  <style type="text/css">
      //#vertical-slider {
      //    height: 150px;
      //    margin-left: 30px;
      //}

      //.ui-slider-pip-selected {
      //    color:steelblue;
      //}

      //.ui-state-focus {
      //    left:100;
      //    color:steelblue;
      //}

      //.ui-state-active {
      //    left:100;
      //    color:steelblue;
      //}
  </style>
</head>
<body>
  <div id="nav">
    <h1><span class="mega-octicon octicon-podium"></span>&nbsp;Debate Watch</h1>
  </div>
  <div id="page">
    <h2 id="event-title">Iowa Republican Lincoln Dinner</h2>
    <div id="player">Loading the player ...</div>
    <div id="feedback">
      <div class="slider" style="margin-top:2em; margin-bottom:2em; height:320px;"></div>
    </div>
    <div id="timeline" style="display:inline-block; margin-top:1em; margin-bottom:1em;"></div>
  </div>
  <div id="footer">
    <a href="https://github.com/debate-watch/poc">source</a>
  </div>
  <script src="bower_components/d3/d3.min.js" charset="utf-8"></script>

  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/jquery.ui/ui/core.js"></script>
  <script src="bower_components/jquery.ui/ui/widget.js"></script>
  <script src="bower_components/jquery.ui/ui/mouse.js"></script>
  <script src="bower_components/jquery.ui/ui/slider.js"></script>
  <script src="bower_components/jquery-ui-slider-pips/dist/jquery-ui-slider-pips.min.js"></script>
  <script type="text/javascript">

      // PLAYER

      var player_options = {
          file_name: '/videos/IowaRepublicanLincolnDinner_400771_3.mp4',
          image_name: '/images/IowaRepublicanLincolnDinner_400771.png',
          height: 360,
          width: 640,
          starting_position: 0
      };

      var player_position = player_options.starting_position;

      var timeline = d3.select("div#timeline").append("svg")
          .attr("height", 36)
          .attr("width", player_options.width)
          .attr("style", "border:1px solid #ccc; background:#eee;")

      var player_position_reference_line = timeline.append("svg:line")
          .attr("x1", player_position)
          .attr("y1", 0)
          .attr("x2", player_position)
          .attr("y2", 100)
          .attr("fill","none")
          .attr("stroke","steelblue")
          .attr("stroke-width","2px")

      var positionToWidth = d3.scale.linear()
          .range([0, player_options.width]);

      d3.json("api_keys.json", function(json){
          var jwplayer_source_url = "http://jwpsrv.com/library/" + json["jwplayer"] + ".js"
          $.getScript(jwplayer_source_url, function( data, textStatus, jqxhr ) {

              var player = jwplayer('player')
                  .setup({
                      file: player_options.file_name,
                      image: player_options.image_name,
                      height: player_options.height,
                      width: player_options.width
                  })
                  .onTime(function(){

                      player_position = this.getPosition();

                      var video_duration = this.getDuration(); // #todo: find a way to avoid setting this every iteration of onTime

                      positionToWidth.domain([0, video_duration]); // #todo: find a way to avoid setting this every iteration of onTime

                      player_position_reference_line.transition()
                          .attr("x1", positionToWidth(player_position))
                          .attr("x2", positionToWidth(player_position));

                      var current_progress = player_position / video_duration;
                      var current_progress_percentage = (current_progress * 100).toFixed(5);
                      console.log("POSITION (s):", player_position, "-- COMPLETION (%):", current_progress_percentage);

                  })

              play()

          });

      });

      function play(){
          jwplayer('player').play(true)
      };

      function pause(){
          jwplayer('player').play(false)
      };

      function stop(){
          jwplayer('player').stop()
      };

      // RATINGS

      var rating_options = {"min": -50, "max": 50, "step":1, "neutral": 0};

      var ratings_slider = $(".slider")
          .slider({
              orientation:"vertical",
              min: rating_options.min,
              max: rating_options.max,
              step: rating_options.step,
              value: rating_options.neutral
          })
          .on("slidechange", function(e,ui){
              if (e.originalEvent) {
                  logRating();
                  resetRating();
              }
          });

      function logRating(){
          var rating = ratings_slider.slider("value")
          console.log(rating);
      };

      function resetRating(){
          ratings_slider.slider("option","value", rating_options.neutral);
      };

  </script>
</body>
</html>
