<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Debate Watch</title>
  <link rel="stylesheet" href="bower_components/octicons/octicons/octicons.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/core.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/slider.css">
  <link rel="stylesheet" href="bower_components/jquery.ui/themes/base/theme.css">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style type="text/css">
      body { padding-top: 60px; }
      nav {height: 60px; }
      /* .navigation .octicon { width: 64px;} */
      div#page {width: 940px; }
      div#player {display:inline-block; }
      div#slider {display:inline-block; height: 360px; margin-left:1em; }
      div#timeline {margin-top:1em; margin-bottom:1em; }
      footer {margin-top: 1em; margin-bottom: 2em; }
      .line {fill: none; stroke: steelblue; stroke-width: 1.5px; }
  </style>
</head>
<body>
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#"><span class="mega-octicon octicon-podium"></span></a>
    </div>
  </nav>

  <div id="page" class="container">
    <div class="page-header">
      <h1 id="event-title">Iowa Republican Lincoln Dinner <small id="event-date">May 10, 2015</small></h1>
    </div>

    <div id="player-container">
      <div class="row">
        <div id="player">Loading the player ...</div>
        <div id="slider"></div>
      </div>
      <div class="row">
        <div id="timeline"></div>
      </div>
    </div>
  </div>

  <footer class="container">
    <hr>
    <a href="https://github.com/debate-watch/poc">source</a>
  </footer>

  <script src="bower_components/d3/d3.min.js" charset="utf-8"></script>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/jquery.ui/ui/core.js"></script>
  <script src="bower_components/jquery.ui/ui/widget.js"></script>
  <script src="bower_components/jquery.ui/ui/mouse.js"></script>
  <script src="bower_components/jquery.ui/ui/slider.js"></script>
  <script type="text/javascript">

      var player

      var ratings = []

      var player_options = {height: 360, width: 640, starting_position: 0, file_name: "/videos/IowaRepublicanLincolnDinner_400771_3.mp4", image_name: "/images/IowaRepublicanLincolnDinner_400771.png"}

      var rating_options = {min: -50, neutral: 0, max: 50, step: 1}

      // slider

      var ratings_slider = $("#slider")
          .slider({orientation:"vertical", min: rating_options.min, max: rating_options.max, step: rating_options.step, value: rating_options.neutral })

      ratings_slider.on("slidechange", function(e,ui){
          if(e.originalEvent){
              getRating()
              ratings_slider.slider("option","value", rating_options.neutral);

          }
      })

      d3.json("api_keys.json", function(json){

          var jwplayer_source_url = "http://jwpsrv.com/library/" + json["jwplayer"] + ".js"

          $.getScript(jwplayer_source_url, function(data, textStatus, jqxhr){

              // player

              player = jwplayer('player')
                  .setup({file: player_options.file_name, image: player_options.image_name, height: player_options.height, width: player_options.width })
                  .onTime(function(e){
                      getRating()
                  });

              play()

          });

      });

      function play(){
          jwplayer('player').play(true)
      };

      function pause(){
          jwplayer('player').play(false)
      };

      function stop(){
          jwplayer('player').stop()
      };

      function getRating(){
          var rating = {position: player.getPosition(), rating_value: ratings_slider.slider("value")}
          ratings.push(rating)
          // todo: overwrite ratings value if one of the ratings has a matching position
          console.log(ratings.length, rating)
      };

  </script>
</body>
</html>
